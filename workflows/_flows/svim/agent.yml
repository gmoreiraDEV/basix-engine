id: svim_brain
namespace: company.svim

inputs:
  - id: message
    type: STRING
  - id: user_id
    type: STRING
    defaults: anonymous
  - id: session_id
    type: STRING
    required: false
  - id: customer_profile
    type: JSON
    required: false
  - id: policies_context
    type: JSON
    required: false

tasks:
  - id: agent
    type: io.kestra.plugin.scripts.python.Commands
    namespaceFiles:
      enabled: true
      include:
        - agents/main.py
        - agents/maria.py
        - agents/requirements.txt
    beforeCommands:
      - pip install -r agents/requirements.txt
    env:
      SVIM_MESSAGE: "{{ inputs.message }}"
      SVIM_USER_ID: "{{ inputs.user_id }}"
      SVIM_SESSION_ID: "{{ inputs.session_id }}"
      SVIM_CUSTOMER_PROFILE: "{{ inputs.customer_profile | toJson }}"
      SVIM_POLICIES_CONTEXT: "{{ inputs.policies_context | toJson }}"
      QDRANT_URL: "{{ kv('QDRANT_URL') }}"
      QDRANT_API_KEY: "{{ kv('QDRANT_API_KEY') }}"
      DATABASE_URL: "{{ kv('SVIM_DB_URL') }}"
      OPENAI_API_KEY: "{{ kv('SVIM_OPENAI_API_KEY') }}"
    commands:
      - python agents/main.py
